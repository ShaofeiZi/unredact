# PDF 涂黑文本恢复与展示工具

本仓库包含一个 Python 工具，用于从 PDF 文件中提取可选定（但视觉上被涂黑）的文本，并以清晰、易读的格式展示，同时尽可能保留原始分页和布局。

该工具旨在用于文档分析、档案审查、研究以及验证涂黑操作的规范性。它不会绕过加密或安全控制；它仅提取仍存在于 PDF 内容流中的文本。

注意 - 并非所有文件都能恢复。此工具仅适用于涂黑处理不当的文件。如果您看到的是空白，说明该文件已正确进行涂黑处理。

---

## 工具功能

许多 PDF 的“涂黑”处理仅仅是在文本上方放置不透明的黑色矩形，而没有实际移除底层的文本对象。在这种情况下，文本仍然可以被选中和复制粘贴。

该工具可以：
- 利用位置信息提取底层文本
- 重建行结构，避免单词重叠和文本连成一片
- 保留原始页面尺寸和分页
- 以两种模式之一生成便于展示的输出

---

## 输出模式

### 1) 并排模式（推荐）

每个输出页面的宽度是原来的两倍：

- **左侧：** 原始 PDF 页面（未更改）
- **右侧：** 重建的、未涂黑的文本，位置与原始布局匹配

此模式非常适合：
- 审查和比对
- 演示或展示
- 审计涂黑操作

示例：

![Side-by-side example](https://raw.githubusercontent.com/leedrake5/unredact/master/examples/an_example.png)

---

### 2) 白字覆盖模式

提取的文本以白色直接绘制在原始 PDF 之上。

如果存在黑色涂黑条，通常无需显式检测或修改这些条块，文本即可变得可见。

此模式适用于：
- 视觉检查
- 演示不当的涂黑处理

---

## 工作原理

1. `pdfplumber` 提取单词及其边界框
2. 根据垂直邻近度将单词分组成行
3. 根据单词间隙重建水平间距
4. `PyMuPDF (pymupdf)` 用于：
   - 嵌入原始页面
   - 以精确位置绘制重建的文本
   - 生成并排或覆盖输出

不执行 OCR（光学字符识别）。

---

## 安装

```bash
pip install pdfplumber pymupdf
```

## 使用

```bash
python redact_extract.py example.pdf
```
